-- CREATE SCHEMA TEST AUTHORIZATION LI;

/* CREATE TABLE DEPT
(
    DEPTNO INTEGER NOT NULL UNIQUE,
    DNAME VARCHAR(18) NOT NULL,
    HEAD CHAR(10) NOT NULL
); */
-- CREATE INDEX DEPTNO ON DEPT;

/* CREATE TABLE STU
(
    STNO CHAR(10) NOT NULL UNIQUE,
    NAME VARCHAR(20) NOT NULL,
    AGE INTEGER NOT NULL,
    MONIT CHAR(10) NOT NULL,
    MACR INTEGER NOT NULL,
    MICR INTEGER NULL,
    EDATE DATETIME NOT NULL,
    DEPTNO INTEGER NOT NULL
); */
-- CREATE INDEX STNO ON STU;

/* CREATE TABLE TEACHER
(
    TNO CHAR(10) NOT NULL UNIQUE,
    NAME VARCHAR(20) NOT NULL,
    AGE INTEGER NOT NULL,
    WDATE DATETIME NOT NULL,
    DEPTNO INTEGER NOT NULL
); */
-- CREATE INDEX TNO ON TEACHER;

/* DROP INDEX DEPTNO;
DROP INDEX STNO;
DROP INDEX TNO;

DROP TABLE DEPT;
DROP TABLE STU;
DROP TABLE TEACHER; */


/* -- 查询DEPT中有哪些数据
SELECT *
FROM DEPT;

-- 查询每个学生的姓名、年龄和主修学分，并按照主修学分由高到低排序
SELECT NAME, AGE, MACR
FROM STU
ORDER BY MACR DESC;

-- 查询23号系的学生姓名
SELECT NAME
FROM STU
WHERE DEPTNO=23;

-- 查询入学日期在2017.1.1与2019.1.1之间的学生姓名
SELECT NAME
FROM STU
WHERE EDATE > 2017-1-1 OR EDATE < 2019-1-1;

-- 按系给出学生人数以及所选学分(主修+辅修)的平均值
SELECT DEPTNO, COUNT(STNO), AVG(MACR+ISNULL(MICR, 0))
FROM STU
GROUP BY DEPTNO;

-- 查询DEPTNO=20的所有主修学分大于平均主修学分的学生信息
SELECT *
FROM STU
WHERE DEPTNO=20 AND MACR > 
(
    SELECT AVG(MACR)
    FROM STU
);

-- 查询入学时间最早且系编号为23的学生信息
SELECT *
FROM STU
WHERE EDATE = 
(
    SELECT MIN(EDATE)
    FROM STU
);

-- 查询学生WANG DONG所在的系的名称和编号
SELECT DEPT.DNAME, DEPT.DEPTNO
FROM DEPT, STU
WHERE STU.NAME='WANG DONG' AND STU.DEPTNO = DEPT.DEPTNO

-- 将学生学分与其班长相比，查出其主修学分至少与其班长相同的学生学号
SELECT STNO
FROM STU x
WHERE x.MACR >=
(
    SELECT MACR
    FROM STU y
    WHERE x.MONIT = y.STNO
);

-- 查与教师ZHANG SAN同系的学生学号和姓名
SELECT STU.STNO, STU.NAME
FROM STU, TEACHER
WHERE STU.DEPTNO = TEACHER.DEPTNO;

-- 查参加工作时间比其所在系的系主任早的教师姓名和所在的系名
SELECT TEACHER.NAME, DEPT.DNAME
FROM DEPT x, TEACHER y
WHERE x.DEPTNO = y.DEPTNO AND y.WDATE <
(
    SELECT WDATE
    FROM TEACHER z
    WHERE x.HEAD = z.TNO
); */


-- 建立电子系学生视图EE_STU
/* CREATE VIEW EE_STU
AS
SELECT *
FROM STU
WHERE DEPTNO = 
(
    SELECT DEPTNO
    FROM DEPT
    WHERE DNAME='EE'
); */

-- 建立系号、系名、系主任姓名的系视图DEPT_VIEW
/* CREATE VIEW DEPT_VIEW
AS
SELECT DEPT.DEPTNO, DEPT.DNAME, TEACHER.NAME
FROM DEPT, TEACHER
WHERE DEPT.DEPTNO = TEACHER.DEPTNO; */

-- 查视图EE_STU中主修学分最高的学生信息
SELECT *
FROM EE_STU
WHERE STNO = 
(
    SELECT MAX(MACR)
    FROM EE_STU
);

-- 列出系视图DEPT_VIEW的全部信息
SELECT *
FROM DEPT_VIEW;

-- 删除视图EE_STU和DEPT_VIEW
DROP VIEW EE_STU;
DROP VIEW DEPT_VIEW;


-- 插入数据
INSERT
INTO DEPT (DEPTNO, DNAME, HEAD)
VALUES(23, 'EE', 'Zhao');

INSERT
INTO DEPT (DEPTNO, DNAME, HEAD)
VALUES(15, 'CS', 'Zhou');

INSERT
INTO DEPT (DEPTNO, DNAME, HEAD)
VALUES(9, 'MATH', 'Feng');

INSERT
INTO DEPT (DEPTNO, DNAME, HEAD)
VALUES(20, 'CHEMISTRY', 'Chu');


INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, MICR, EDATE, DEPTNO)
VALUES('202001001', 'Alice', 19, '202001001', 63, 24, 2018-9-8, 23);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, MICR, EDATE, DEPTNO)
VALUES('202001002', 'Bob', 22, '202001001', 159, 62, 2016-9-2, 23);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, EDATE, DEPTNO)
VALUES('202001003', 'Carol', 19, '202001001', 48, 2018-9-10, 23);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, MICR, EDATE, DEPTNO)
VALUES('202001004', 'Dave', 20, '202001001', 104, 44, 2017-9-1, 23);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, MICR, EDATE, DEPTNO)
VALUES('202001005', 'Eve', 19, '202001001', 61, 35, 2018-9-6, 23);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, EDATE, DEPTNO)
VALUES('202001006', 'Francis', 17, '202001001', 21, 2019-9-5, 23);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, MICR, EDATE, DEPTNO)
VALUES('202001007', 'Grace', 18, '202001001', 49, 36, 2018-9-2, 23);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, MICR, EDATE, DEPTNO)
VALUES('202001008', 'Hans', 19, '202001008', 89, 52, 2017-9-4, 15);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, MICR, EDATE, DEPTNO)
VALUES('202001009', 'Isabella', 21, '202001008', 172, 81, 2016-9-5, 15);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, MICR, EDATE, DEPTNO)
VALUES('202001010', 'Jason', 18, '202001008', 18, 8, 2019-9-2, 15);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, EDATE, DEPTNO)
VALUES('202001011', 'Kate', 20, '202001008', 103, 2017-9-3, 15);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, EDATE, DEPTNO)
VALUES('202001012', 'Louis', 19, '202001008', 57, 2018-9-7, 15);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, MICR, EDATE, DEPTNO)
VALUES('202001013', 'Margaret', 18, '202001013', 65, 33, 2018-9-7, 9);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, MICR, EDATE, DEPTNO)
VALUES('202001014', 'Nathan', 20, '202001013', 123, 15, 2017-9-1, 9);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, MICR, EDATE, DEPTNO)
VALUES('202001015', 'Olivia', 19, '202001015', 110, 35, 2017-9-6, 20);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, MICR, EDATE, DEPTNO)
VALUES('202001016', 'Paul', 20, '202001015', 64, 19, 2018-9-3, 20);

INSERT
INTO STU (STNO, NAME, AGE, MONIT, MACR, EDATE, DEPTNO)
VALUES('202001017', 'WANG DONG', 17, '202001015', 48, 2018-9-5, 20);


INSERT
INTO TEACHER (TNO, NAME, AGE, WDATE, DEPTNO)
VALUES('202002001', 'Zhao', 45, 2014-6-2, 23);

INSERT
INTO TEACHER (TNO, NAME, AGE, WDATE, DEPTNO)
VALUES('202002002', 'Qian', 58, 2004-8-16, 23);

INSERT
INTO TEACHER (TNO, NAME, AGE, WDATE, DEPTNO)
VALUES('202002003', 'Sun', 34, 2019-5-7, 23);

INSERT
INTO TEACHER (TNO, NAME, AGE, WDATE, DEPTNO)
VALUES('202002004', 'Li', 42, 2018-12-18, 23);

INSERT
INTO TEACHER (TNO, NAME, AGE, WDATE, DEPTNO)
VALUES('202002099', 'ZHANG SAN', 41, 2016-1-8, 23);

INSERT
INTO TEACHER (TNO, NAME, AGE, WDATE, DEPTNO)
VALUES('202002005', 'Zhou', 39, 2017-1-14, 15);

INSERT
INTO TEACHER (TNO, NAME, AGE, WDATE, DEPTNO)
VALUES('202002006', 'Wu', 51, 2009-3-2, 15);

INSERT
INTO TEACHER (TNO, NAME, AGE, WDATE, DEPTNO)
VALUES('202002007', 'Zhen', 38, 2016-10-4, 15);

INSERT
INTO TEACHER (TNO, NAME, AGE, WDATE, DEPTNO)
VALUES('202002008', 'Wang', 32, 2020-11-7, 15);

INSERT
INTO TEACHER (TNO, NAME, AGE, WDATE, DEPTNO)
VALUES('202002009', 'Feng', 52, 2010-7-9, 9);

INSERT
INTO TEACHER (TNO, NAME, AGE, WDATE, DEPTNO)
VALUES('202002010', 'Chen', 47, 2015-3-18, 9);

INSERT
INTO TEACHER (TNO, NAME, AGE, WDATE, DEPTNO)
VALUES('202002011', 'Chu', 46, 2013-8-11, 20);

INSERT
INTO TEACHER (TNO, NAME, AGE, WDATE, DEPTNO)
VALUES('202002012', 'Wei', 59, 2006-2-4, 20);

