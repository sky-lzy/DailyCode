# 背景介绍
在处理某些事情与任务中，经常会遇到一些较为特殊的环境情况，不适宜人类直接进入环境中进行操作，如火灾现场、地震灾区、核辐射地带等。因此，需要寻找一些智能系统辅助人类进行操作。

据此，我们设计了一个能够适应复杂环境、执行特殊任务的智能小车，通过操作者远程非接触式操作能够控制小车的运动状态，并执行相应的任务。整体构思为使用语音控制、语音播报、蓝牙传输、红外传输等技术手段，控制小车的运动及获取环境信息。同时能够通过远程操作控制智能小车的装置，进行清障、完成相应任务的功能。


<br/>
<br/>
<br/>

# 功能介绍
## 语音控制运动状态
操作者可以通过非接触式向智能小车系统发出语音指令，智能小车受到信息之后会按照要求调整运动状态，如下：

    语音口令："qian"(前)  智能小车：向前运动
    语音口令："dao"(倒)   智能小车：向后运动
    语音口令："zuo"(左)   智能小车：向左转弯
    语音口令："you"(右)   智能小车：向右转弯
    语音口令："yi"        智能小车：停止

## 遥控机械臂清障
在遇到障碍物时，操作者可以通过遥控机械臂将前方障碍物夹起清除。指令如下：

    遥控按键：上    机械臂：向上升起
    遥控按键：下    机械臂：向下降落
    遥控按键：左    机械臂：夹子张开
    遥控按键：右    机械臂：夹子闭合
    遥控按键：OK    机械臂：运动停止

## LED工作指示及信号提示
在机械臂工作时，LED会根据机械臂工作状态显示相应的颜色，提示当前状态，如下：

    绿色：机械臂舵机未工作
    红色：机械臂舵机朝方向一转动
    蓝色：机械臂舵机朝方向二转动

同时，操作者可以通过按键"1"、"2"、"3"、"4"、"5"、"6"分别控制灯的亮暗，便于操作者通过远程遥控发出指示信号。

## 环境温湿度的测量及警示
为保障小车的正常工作，需要对环境温湿度进行实时监测。通过传感模块可以将温湿度测量并显示至小车前端的LCD屏幕上。当环境超出正常范围时(如过冷、过热等)，智能小车将通过语音合成发出警示(如"温度过低"、"温度过高"等)。

## 行进过程中障碍物的监测
为保障智能小车的正常行进，需要对前方的障碍物进行监测。当前方出现障碍物且小于规定距离时(本实验设置为20cm)，智能小车将发出"障碍物"的警示语音，提醒操作者采取相应措施。

## 语音状态的播报
为便于操作者使用，智能小车在发出警示(如"温度过低"、"障碍物")等同时会通过语音合成模块进行播报，实时提醒操作者进行调整。

## 远程遥控操作
为便于操作者进行非接触式控制智能小车的状态，系统提供红外遥控功能。操作者可以通过遥控按键控制机械臂的状态进行清障，及控制LED指示灯的状态。

## 智能小车状态的蓝牙通信
为便于操作者在远处能够实时检测智能小车所处的环境，系统提供蓝牙信号传递功能。当操作者的蓝牙设备连接上智能小车时，智能小车将会把实时的状态传递至操作者的蓝牙设备上。如当前环境的温湿度、一些警示信息等。

<br/>
<br/>
<br/>

# 所用模块和器件
## LD3320语音识别模块
### 整体介绍
本实验中对小车的控制采用了语音控制这一突出亮点，智能小车能够通过对外界声音的感知，并整合有效信息用以控制智能小车的运动状态。本功能主要通过LD3320语音识别模块完成以下是功能的详细介绍。

### LD3320模块简要说明
本次实验所使用的LD3320模块为SPI版本，该版本不内置单片机，因此设计将其与Arduino UNO相连，采用通信手段传递信息，主要接口如下：

    Vcc、GND、MI、MO、SCK、CS、RST、IRQ、WR

### 模块的使用
其具体功能的内部实现已经封装为"ld3320.h"、"ld3320.cpp"及"PinMap.h"文件，使用时需要依次使用以下函数：

    VoiceRecognition Voice;      //声明语音识别对象
    Voice.init();                //初始化对象
    Voice.addCommand("kai", 1);  //添加"kai"的口令，返回1
    Voice.start();               //开始识别
    Voice.read();                //读取返回信息

在正确连接引脚之后，Arduino能够调用以上函数获取信息，并通过这些信息对当前智能小车的运动状态进行调整。

### 控制功能的实现
在本次实验中，语音识别模块主要用于调整小车的运动状态。通过添加口令，能够实现发出"qian"让小车前进、"dao"让小车后退、"zuo"让小车向左转弯、"you"让小车向右转弯、"yi"让小车停下。经过试验发现，调试后语音识别的准确度较高，最远能够接受数米远的口令并进行相应状态的调整。

### 可以预期的改进
在本次实验中，我们也发现了一些能够继续优化改进之处，如下：

    1. 可以设置分级口令，让智能小车在收到特定口令时再执行后续操作，防止来自环境的声音干扰
    2. 可以与语音播报模块相结合，与使用者进行一些简单的语音交互
    3. 可以修正某些口令的内部实现以提高识别准确性


## Arduino红外遥控模块
### 整体介绍
为了方便使用者与小车的非接触式交互，在提供语音识别控制小车运动之外，同时考虑了采用红外遥控向系统传递信息。此功能具有较大的实用意义，能够为操作者提供更多接口以控制智能小车。

### 红外遥控模块简要说明
该模块主要由遥控器面版及红外信号接收器两部分构成。其中红外信号接收器与Arduino UNO相连，通过引脚连接向Arduino传输信息。遥控器面版共17个按键，分别为"数字0~9"、"*"、"#"、"上下左右箭头"、"OK"，按下每个按键都会给Arduino传输相应特定信号，进而达到交互的目的。

### 模块的使用
可以通过调用Arduino库函数"IRremote.h"文件封装的操作完成指定功能，使用时需要依次执行以下函数：

    IRrecv irrecv(RECV_PIN); //初始化红外接收对象
    decode_results results;  //解码结果
    irrecv.enableIRIn();     //启动接收器
    irrcv.decode(&results);  //接收红外讯号
    results.value            //红外信号解码值


## LED模块
### 整体介绍
LED模块使用较为简单，将其各引脚与Arduino相应端口相连即可，通过控制输出电压控制LED的工作状态。

### 功能使用
在本次实验中，使用LED作为探照灯及信号传输灯，通过遥控器的各按键可以依次实现两盏LED 6个引脚的开关，依次呈现不同的颜色，便于在不同环境时发出不同的警示信号，同时可以作为小车在极端环境下的探测灯实现。

同时，两盏LED灯在不同的状态下可以分别指示机械臂两舵机的工作状态，便于操作者控制。


## 电机模块（部分）
### 功能实现
为避免板间通信所带来的时间误差，最终决定采取四轮驱动+同侧电机转速相等的方法。此模式可以通过同侧电机引脚并联实现，保证电机的输入电压相等，可以达到预期目的。控制各运动状态的转速如下：

    前进：四轮均保持中速向前行驶
    后退：四轮均保持中速向后行驶
    左转：左侧轮低速行驶、右侧轮高速行驶
    右转：右侧轮低速行驶、左侧轮高速行驶


## 超声测距模块
### 整体介绍
超声测距模块连线较为简单，主要功能是将测距信号传递给Arduino板。只需将引脚与Arduino通信引脚相连，设置好通信即可。

### 功能使用
在本次实验中，此超声测距模块主要用在智能小车前端，在距离前方障碍物较近时(该实验设定值为小于20cm)，即发出信号。此时Arduino板收到信号会给语音合成模块发出指令，发出"障碍物"的警示。同时操作者可以通过红外遥控使得机械臂进行清障。


## OV7670摄像模块
OV7670摄像模块并不存在于我们最终的智能系统当中，但在调试过程中我们也取得了一定的阶段性成果。

初步构思是希望能够将摄像模块置于智能小车前方，据此得到实时传回的图像。但调试过程中发现，其出现的问题有：

    1. 由于OV7670需要传输的数据量较大，而模块与Arduino间的通信效果较差(此处我们仅用的是不含FIFO驱动的模块)，因此传输至显示界面的图像速率跟不上拍摄的图像速率，导致效果较差。为解决此问题，可能需要更换性能更强大的单片机板，同时升级摄像模块；
    2. 由于我们主要使用的是Arduino UNO板，故与摄像模块相连之后，引脚剩余量较少，难以实现较好的通信(如再配合ESP8266 WiFi模块)，故远程数据传输受阻。

基于以上的困难，我们最终并未在成品中使用OV7670模块。

<br/>
<br/>
<br/>

# 所用技术
## 红外通信技术
### 整体介绍
红外通信技术主要用于实现红外遥控器(操作者)到红外接收器(系统)的单向信息传输，使得操作者可以通过一些远程非接触式指令便捷地控制系统的状态，并调整系统的工作。
### 技术实现
当模块均正确连接、接收器与Arduino之间的驱动成功配置时，可以通过按下遥控器的各按键向接收器发送指令。Arduino接收指令并解析，可以获取相应的数据。此处每一个按键传递的信息按照24bit编码传输(即6位16进制数)，所有信息均以0xFF起始，据此判断是否为红外接收信号并进行相应处理。
### 功能使用
通过红外信号传输，可以实现使用遥控远距离控制智能小车的工作状态，如调整机械臂的张合角度、控制指示灯的亮灭等。

<br/>
<br/>
<br/>

# 调试过程
## 电机四轮驱动的实现
### 问题与困难
在前期的调试过程中，我们发现用语音识别进行控制小车的运动状态可以实现，且可以通过左右轮差速的方式可以实现转弯等操作。此时我们采用的结构是后轮驱动、前轮从动的模式。但当智能小车进一步优化搭建时，我们发现其质量已经远大于原来的测试质量，在这种情况下，智能小车仅能完成缓慢的前进、后退操作，而无法实现左右转弯(因为重力的增加使得摩擦阻力显著增大)。因此，必须要调整优化小车驱动结构。

### 改进方向
经过初步设想，我们提出了以下几种改进方向：

    1. 增大驱动的马力，强制其运动
    2. 采用四轮驱动结构，用另一块Arduino板控制另外的电机，通过板间通信或两块语音识别模块的形式控制
    3. 采用四轮驱动结构，使得同侧轮以相同速率转动
    4. 减轻小车自重，还原智能小车初始状态

### 尝试与选择
首先，我们加大驱动马力，发现并无法从根本上解决问题，且对后轮主动电机损伤较大。
而通过通信传递信息，发现send与recieve之间几乎总是有一定的时间间隔，从而导致运动状态切换不灵敏、无法高效完成指定任务。
若采用两块语音识别板，则需要考虑误差等偶然因素使得两模块可能工作状态并不同步，进而引发异常情况。

### 改进方案
通过以上尝试，我们最终确定的改进方案是采用四轮驱动，且同侧的两轮转速相同，如此可避免需要多块Arduino板进行通信从而造成的时间差。因此可将两个电机的输入端并联，引出一个接口，与原引脚相连，即可实现四轮驱动。


## 坦克外形的取舍与优化
我们的原定计划是设计一个坦克，如此可满足小车在"全地形"、"极端环境"下的功能应用。但是设计过程中面临以下问题：

    1. 坦克转动轮适配电机转速固定，意味着难以实现差速转弯、PID稳定速度等功效
    2. 坦克底板宽度不足，无法接入小车所用的电机
    3. 若用小车轮套履带，会导致轮子受侧压力较大而难以转动

因此，在综合以上考量之后，我们保留了部分坦克设计的外形，而运动部分决定采用小车结构。


<br/>
<br/>
<br/>

# 参考资料
## 红外信号传输
    Arduino-IRremote-红外遥控器,发射与接收

    https://blog.csdn.net/zuoheizhu/article/details/87452110?ops_request_misc=&request_id=&biz_id=102&utm_term=arduino%E9%81%A5%E6%8E%A7%E8%BF%9E%E7%BA%BF&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-87452110.pc_search_all_es&spm=1018.2226.3001.4187

## LD3320语音识别模块

    1. 洪家平：《LD3320的嵌入式语音识别系统的应用》，《新器件新技术》，2012年第2期，47~49页
    2. 张戟、杨腾飞：《车载自动语音识别》，《佳木斯大学学报》，2011年3月，第29卷第2期，201~205页
    3. 金鑫、田犇、阙大顺：《基于LD3320的语音控制系统设计实现》，《电脑与信息技术》，2011年12月，第19卷第6期


<br/>
<br/>
<br/>

# 小组分工
## 软件部分(代码)

    1. 实现语音识别模块的配置、调试、添加口令等操作
    2. 实现语音控制小车的运动状态的代码(即语音识别与电机模块协调工作)
    3. 实现UNO板间串口通信代码，实现板间信息传输
    4. 实现红外通信的调试与配置
    5. 实现遥控代码，通过遥控器传输信息
    6. 实现遥控控制机械臂舵机的算法代码及指示灯的工作状态

## 硬件部分

    1. 小车外形结构的设计
    2. 语音识别模块与电机相互协调配合
    3. 智能小车四轮驱动的实现
    4. 用户与系统交互设计(遥控器等)
    5. 遥控与机械臂的协调配合
    6. LED指示灯显示机械臂的工作状态

## 其它方面

    1. 部分设计创意、系统功能的提出
    2. 所用模块的说明与调试

<br/>
<br/>
<br/>

# 心得体会
## 总结回顾
智能小车的设计，主要解决的问题在以下两方面：

    1. 系统与外界(操作者)进行交互，能够接收外界信号并以此调节自身状态。同时也可以向外界发出信息，传递数据；
    2. 系统内部各模块间的协同配合，如LED指示机械臂的工作状态、极端环境向外界发出警示等。

这二者展现了系统最关键的两个特性：相互配合和与外界交互。因此，当我们进行设计时，重点从这两方面出发思考实践：

    1. 与外界的交互可以通过语音控制、语音播报、蓝牙传输、红外传输等手段，因此可以设计语音识别模块与电机的配合，达到语音控制小车运动；可以设计遥控器控制机械臂，使操作者可以控制机械臂的状态；
    2. 系统内部各模块之间配合使得各功能得以实现，包括LED与机械臂的联动使得可以指示机械臂的工作状态；语音合成与超声测距联动可以实时发出警示信息等。

通过"解决这两个问题"的思路，即可大体构建出智能小车系统的框架。

## 改进与展望
在本系统的基础上，智能小车还可以进行进一步的展望：

    1. 为解决环境干扰对小车语音识别的干扰，可以考虑进一步添加分级口令：如先说"小车小车"，再发出口令才视为有效，可以解决无关指令干扰问题；
    2. 为使得小车速度能够进一步控制，可以使用遥控器按键对小车的运动速度进行调整。(此需要改进PID算法，以及红外与Arduino的通信问题)。